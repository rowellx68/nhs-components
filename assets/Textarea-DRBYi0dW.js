import{r as h,R as o}from"./index-DCEVbkbO.js";import{F as b}from"./FormGroup-NsXkChrc.js";import{f as x}from"./factory-B-vprWl1.js";import{c as $}from"./clsx-B-dksMZM.js";import{B as k}from"./Base-CSr0pwnM.js";import{H as C}from"./Hint-DTOWly4i.js";class d{constructor(e){this.$module=e,this.$textarea=e.querySelector(".nhsuk-js-character-count"),this.$visibleCountMessage=null,this.$screenReaderCountMessage=null,this.lastInputTimestamp=null}init(){if(!this.$textarea)return;const{$module:e}=this,{$textarea:t}=this,s=document.getElementById(`${t.id}-info`);t.insertAdjacentElement("afterend",s);const r=document.createElement("div");r.className="nhsuk-character-count__sr-status nhsuk-u-visually-hidden",r.setAttribute("aria-live","polite"),this.$screenReaderCountMessage=r,s.insertAdjacentElement("afterend",r);const a=document.createElement("div");a.className=s.className,a.classList.add("nhsuk-character-count__status"),a.setAttribute("aria-hidden","true"),this.$visibleCountMessage=a,s.insertAdjacentElement("afterend",a),s.classList.add("nhsuk-u-visually-hidden"),this.options=d.getDataset(e);let n=this.defaults.characterCountAttribute;this.options.maxwords&&(n=this.defaults.wordCountAttribute),this.maxLength=e.getAttribute(n),this.maxLength&&(t.removeAttribute("maxlength"),this.bindChangeEvents(),"onpageshow"in window?window.addEventListener("pageshow",this.updateCountMessage.bind(this)):window.addEventListener("DOMContentLoaded",this.updateCountMessage.bind(this)),this.updateCountMessage())}static getDataset(e){const t={},{attributes:s}=e;if(s)for(let r=0;r<s.length;r++){const a=s[r],n=a.name.match(/^data-(.+)/);n&&(t[n[1]]=a.value)}return t}count(e){let t;return this.options.maxwords?t=(e.match(/\S+/g)||[]).length:t=e.length,t}bindChangeEvents(){const{$textarea:e}=this;e.addEventListener("keyup",this.handleKeyUp.bind(this)),e.addEventListener("focus",this.handleFocus.bind(this)),e.addEventListener("blur",this.handleBlur.bind(this))}checkIfValueChanged(){this.$textarea.oldValue||(this.$textarea.oldValue=""),this.$textarea.value!==this.$textarea.oldValue&&(this.$textarea.oldValue=this.$textarea.value,this.updateCountMessage())}updateCountMessage(){this.updateVisibleCountMessage(),this.updateScreenReaderCountMessage()}updateVisibleCountMessage(){const{$textarea:e}=this,{$visibleCountMessage:t}=this,s=this.maxLength-this.count(e.value);this.isOverThreshold()?t.classList.remove("nhsuk-character-count__message--disabled"):t.classList.add("nhsuk-character-count__message--disabled"),s<0?(e.classList.add("nhsuk-textarea--error"),t.classList.remove("nhsuk-hint"),t.classList.add("nhsuk-error-message")):(e.classList.remove("nhsuk-textarea--error"),t.classList.remove("nhsuk-error-message"),t.classList.add("nhsuk-hint")),t.innerHTML=this.formattedUpdateMessage()}updateScreenReaderCountMessage(){const{$screenReaderCountMessage:e}=this;this.isOverThreshold()?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",!0),e.innerHTML=this.formattedUpdateMessage()}formattedUpdateMessage(){const{$textarea:e}=this,{options:t}=this,s=this.maxLength-this.count(e.value);let r="remaining",a="character",n=s;return t.maxwords&&(a="word"),a+=s===-1||s===1?"":"s",r=s<0?"too many":"remaining",n=Math.abs(s),`You have ${n} ${a} ${r}`}isOverThreshold(){const{$textarea:e}=this,{options:t}=this,s=this.count(e.value),{maxLength:r}=this,a=t.threshold?t.threshold:0;return r*a/100<=s}handleKeyUp(){this.updateVisibleCountMessage(),this.lastInputTimestamp=Date.now()}handleFocus(){this.valueChecker=setInterval(()=>{(!this.lastInputTimestamp||Date.now()-500>=this.lastInputTimestamp)&&this.checkIfValueChanged()},1e3)}handleBlur(){clearInterval(this.valueChecker)}}d.prototype.defaults={characterCountAttribute:"data-maxlength",wordCountAttribute:"data-maxwords"};const M=({scope:i=document}={})=>{i.querySelectorAll('[data-module="nhsuk-character-count"]').forEach(t=>{new d(t).init()})},l=x(({variant:i="textarea",maxCharacterLength:e,maxWords:t,...s},r)=>{h.useImperativeHandle(r,()=>a.current);const a=h.useRef(null),n=i!=="textarea",m={as:n?"div":o.Fragment,...n?{className:"nhsuk-character-count","data-module":"nhsuk-character-count","data-maxwords":i==="word-count"?t:void 0,"data-maxlength":i==="character-count"?e:void 0}:{}},g=h.useMemo(()=>{if(i==="character-count")return`You have ${e} characters remaining`;if(i==="word-count")return`You have ${t} words remaining`},[i,t,e]);return h.useEffect(()=>{var c;if(!n||!a.current)return;const u=(c=a.current.closest(".nhsuk-character-count"))==null?void 0:c.parentElement;u&&M({scope:u})},[a,n,e,t]),o.createElement(k,{...m},o.createElement(b,{as:"textarea",inputType:"textarea",withErrorLine:!0,...s,ref:a,render:({id:u,name:c,className:p,withError:f,...v})=>o.createElement(o.Fragment,null,o.createElement("textarea",{id:u,name:c,className:$("nhsuk-textarea",{"nhsuk-textarea--error":f,"nhsuk-js-character-count":n},p),...v}),n&&o.createElement(C,{className:"nhsuk-character-count__message",id:`${u}-info`},g))}))});l.displayName="Textarea";l.__docgenInfo={description:"",methods:[],displayName:"Textarea",props:{variant:{defaultValue:{value:"'textarea'",computed:!1},required:!1}}};export{l as T};
